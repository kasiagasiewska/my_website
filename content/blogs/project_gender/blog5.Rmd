---
categories:
- ""
- ""
date: "2017-10-31T22:42:51-05:00"
description: Enter to see whether women get paid less than men!
draft: false
image: pic05.jpg
keywords: ""
slug: gender
title: Gender Pay Gap
---


```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE, 
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code
options(digits = 3)

# default figure size
knitr::opts_chunk$set(
  fig.width=6.75, 
  fig.height=6.75,
  fig.align = "center"
)
```


```{r load-libraries, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(mosaic)
library(ggthemes)
library(GGally)
library(readxl)
library(here)
library(skimr)
library(janitor)
library(broom)
library(tidyquant)
library(infer)
library(openintro)
library(kableExtra)
```

# Omega Group plc- Pay Discrimination

At the last board meeting of Omega Group Plc., the headquarters of a large multinational company, the issue was raised that women were being discriminated in the company, in the sense that the salaries were not the same for male and female executives. A quick analysis of a sample of 50 employees (of which 24 men and 26 women) revealed that the average salary for men was about 8,700 higher than for women. This seemed like a considerable difference, so it was decided that a further analysis of the company salaries should be conducted. 

Our team carried out the analysis to find out whether there is indeed a significant difference between the salaries of men and women, and whether the difference is due to discrimination or whether it is based on another, possibly valid, determining factor. 

```{r load_omega_data}
omega <- read_csv(here::here("data", "omega.csv"))
glimpse(omega) # examine the data frame
```


## Is there a significant difference between the salaries of the male and female executives?

```{r, confint_single_valiables}
# Summary Statistics of salary by gender
mosaic::favstats (salary ~ gender, data=omega)

# Dataframe with two rows (male-female) and having as columns gender, mean, SD, sample size, 
# the t-critical value, the standard error, the margin of error, 
# and the low/high endpoints of a 95% confidence interval
statistics<-omega%>%
select(salary,gender)%>%
  group_by(gender)%>%
  summarise(mean = mean(salary),
            SD = sd(salary),
            SampleSize = n(),
            t_crit = qt(0.975,SampleSize-1),
            SE = SD/sqrt(SampleSize),
            MarginError = t_crit*SE,
            LowBound = mean - MarginError,
            HighBound = mean + MarginError)
statistics

```

> From the data obtained, we can observe that the confidence intervals do not overlap. Hence, we can conclude that there is a significant difference between the salaries of male and female executives. 


```{r, hypothesis_testing_salary_gender}
# Hypothesis testing using t.test() 
t.test(salary ~ gender, data = omega)

# Hypothesis testing using infer package

#Initialize the test
init_sal_null<-omega%>%
specify(salary ~ gender)%>%
calculate(stat="diff in means",order=c("female","male")) 

#Simulate the test on the null distribution, which we will save as null
salaries_null_world<-omega%>%
  specify(salary ~ gender)%>%
  hypothesize(null="independence")%>%
  generate(reps=1000,type="permute")%>%
  calculate(stat="diff in means",order=c("female","male"))

#Visualize the null distribution and get the p value
salaries_null_world %>% visualize() +
  shade_p_value(obs_stat = init_sal_null, direction = "two-sided")+
  
  #Customize the plot
  labs(x="Difference between mean salary of women and men",y="Count",title="Is there a significant difference between men and women's salaries?",subtitle="Null hypothesis distribution and p-value")+theme_clean()

#Get the numerical value for p
salaries_null_world %>% get_p_value(obs_stat = init_sal_null, direction = "two_sided")
```

> From the hypothesis testing, we are more than 95% confident that the null hypothesis is untrue. A significant difference between the male and female executive salaries has been confirmed in 3 different ways: the hypothesis testing using t.test(), the plot of the null hypothesis distribution with a red line corresponding to the p-threshold (as we can visually observe the line is very far away from 0), and a p<0.05. However, we cannot affirm that this significant difference is due to discrimination as there may be some other factors involved. Finding out the true causes of the salary gap requires further analyses.

## Is there a significant difference between the experience of the male and female executives?

```{r, experience_stats}
# Summary Statistics of experience by gender
favstats (experience ~ gender, data=omega)

#Calculate additional key statistics and confidence intervals
statistics<-omega%>%
select(experience,gender)%>%
  group_by(gender)%>%
  summarise(mean = mean(experience),
            SD = sd(experience),
            SampleSize = n(),
            t_crit = qt(0.975,SampleSize-1),
            SE=SD/sqrt(SampleSize),
  MarginError=t_crit*SE,LowBound=mean-MarginError,HighBound=mean+MarginError)
statistics
```

> The 95% confidence intervals do not overlap. Hence, we can conclude that there is a significant difference in the experience of female and male executives.
Further tests based on null hypothesis are conducted below.  


```{r, hypothesis_testing_experience}
# Hypothesis testing using t.test() 
t.test(experience ~ gender, data = omega)

# Hypothesis testing using infer package
#Initialize the test
init_exp_null <- omega %>%
specify(experience ~ gender)%>%
calculate(stat="diff in means",order=c("female","male")) 

#Simulate the test on the null distribution, which we will save as experience_null_world
experience_null_world <- omega %>%
  specify(experience ~ gender) %>%
  hypothesize(null="independence") %>%
  generate(reps=1000,type="permute") %>%
  calculate(stat="diff in means",order=c("male","female"))

#Visualize the null distribution and get the p value
experience_null_world %>% visualize() +
  shade_p_value(obs_stat = init_exp_null, direction = "two-sided")+
 
   #Customize the plot
  labs(x="Difference between mean experience of women and men",
       y="Count",
       title="Is there a significant difference between men and women's experience?",
       subtitle="Null hypothesis distribution and p-value") +
  theme_clean()

#Get the numerical p value
experience_null_world %>% get_p_value(obs_stat = init_exp_null, direction = "two_sided")
```

> From the data obtained using t.test(), the plot of the null distribution and the p value (which is less than 0.05), we can reject the null hypothesis. Hence, we can conclude that there is a significant difference between the experience of men and women. This conclusion doesn't endanger the previous one that indicated that salaries of men and women are significantly different. However, from the current analysis, we can say the salaries are not necessarily different due to factors such as gender discrimination, there can be other factors such as experience having an important effect on the salary gap.


## The relationship between salary and experience

```{r, salary_exp_scatter}

ggplot(omega,aes(x = experience,
                 y = salary)) + 
  geom_smooth() + 
  theme_clean() + 
  geom_point() + 
  labs(title = "Relationship between experience and salary",
       x="Experience",
       y="Salary")

```

## Check correlations between the data

We will generate a matrix in order to better visualize relationships between salary, experience and gender before reaching a conclusion.
```{r, ggpairs}
omega %>% 
  select(gender, experience, salary) %>% #order variables they will appear in ggpairs()
  ggpairs(aes(colour = gender, alpha = 0.3))+
  theme_bw()
```

>The scatterplot displaying the relationship between salary and experience shows us that these two variables are positively correlated. Moreover, their relationship resemble a logarithmic function, meaning that the marginal effect of a year of experience is positive but decreases over time.

>Our previous hypothesis testing and the correlation matrix confirm that males have on average more experience and higher salaries than females at Omega. Moreover,the correlation between salary and experience is positive and significant for both genders (ρ females= 0.812, ρ males= 0.661, ρ both=0.803), validating that the salary gap between the two groups may not come from discrimination but mainly from the difference in experience.

>Note that the slight discrepancy in the correlation between salary and experience across genders is caused by the cluster at experience=0 : many females at Omega have no experience and start at different salaries, perhaps because they have different degrees or backgrounds. Since we have no data points for males at experience=0 , it generates a difference between ρ females and  ρ males. It would have been interestin tog analyze further if the same would have happened to males with no experience.
